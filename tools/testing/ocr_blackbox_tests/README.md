# OCR to ExamX é»‘ç®±æµ‹è¯•æ¡†æ¶

æœ¬ç›®å½•åŒ…å«å¯¹ `tools/core/ocr_to_examx.py` è„šæœ¬çš„ç³»ç»Ÿæ€§é»‘ç®±æµ‹è¯•æ¡†æ¶ã€‚

## ç›®å½•ç»“æ„

```
ocr_blackbox_tests/
â”œâ”€â”€ README.md              # æœ¬æ–‡ä»¶
â”œâ”€â”€ test_cases.md          # æµ‹è¯•ç”¨ä¾‹å®šä¹‰ï¼ˆT001-T020ï¼‰
â”œâ”€â”€ run_tests.py           # è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
â”œâ”€â”€ analyze_results.py     # ç»“æœåˆ†æè„šæœ¬
â”œâ”€â”€ SUMMARY.md             # æµ‹è¯•æ€»ç»“æŠ¥å‘Š
â”œâ”€â”€ ISSUES.md              # é—®é¢˜æ¸…å•
â”œâ”€â”€ input/                 # æµ‹è¯•è¾“å…¥æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ output/                # è½¬æ¢è¾“å‡ºçš„ TeX æ–‡ä»¶
â”œâ”€â”€ reports/               # JSON æ ¼å¼çš„æµ‹è¯•æŠ¥å‘Š
â”œâ”€â”€ expected/              # æœŸæœ›ç»“æœï¼ˆå¯é€‰ï¼‰
â””â”€â”€ edge_cases/            # è¾¹ç•Œæµ‹è¯•ç”¨ä¾‹
```

## å¿«é€Ÿå¼€å§‹

### 1. æµ‹è¯•å•ä¸ªæ–‡ä»¶

```bash
python3 tools/testing/ocr_blackbox_tests/run_tests.py \
    word_to_tex/output/gaokao_2025_national_1_preprocessed.md
```

### 2. æ‰¹é‡æµ‹è¯•æ‰€æœ‰æ–‡ä»¶

```bash
for f in word_to_tex/output/*_preprocessed.md; do
    echo "========== æµ‹è¯•: $(basename "$f") =========="
    python3 tools/testing/ocr_blackbox_tests/run_tests.py "$f"
done
```

### 3. ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š

```bash
python3 tools/testing/ocr_blackbox_tests/analyze_results.py
```

è¿™å°†ç”Ÿæˆï¼š
- `SUMMARY.md`: æµ‹è¯•æ€»ç»“ï¼ŒåŒ…å«é€šè¿‡ç‡ç»Ÿè®¡
- `ISSUES.md`: è¯¦ç»†é—®é¢˜æ¸…å•ï¼ŒæŒ‰ä¸¥é‡ç¨‹åº¦æ’åº

## æµ‹è¯•ç”¨ä¾‹

æ¡†æ¶åŒ…å« 18 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–ä»¥ä¸‹æ–¹é¢ï¼š

### å…ƒä¿¡æ¯è§£æï¼ˆT001-T005ï¼‰
- âœ… T001: ã€ç­”æ¡ˆã€‘æå–
- âœ… T002: ã€éš¾åº¦ã€‘æå–
- âœ… T003: ã€çŸ¥è¯†ç‚¹ã€‘/ã€è€ƒç‚¹ã€‘åˆå¹¶
- âœ… T004: ã€åˆ†æã€‘è¿‡æ»¤
- âœ… T005: ã€è¯¦è§£ã€‘ä¿ç•™

### æ•°å­¦å…¬å¼ï¼ˆT006-T010ï¼‰
- âŒ T008: å®šç•Œç¬¦å¹³è¡¡ **[P0 é—®é¢˜]**
- âœ… T009: åå‘å®šç•Œç¬¦æ£€æµ‹
- âœ… T010: åŒé‡åŒ…è£¹æ£€æµ‹

### ç»“æ„å®Œæ•´æ€§ï¼ˆT011-T013ï¼‰
- âœ… T011: question ç¯å¢ƒé—­åˆ
- âœ… T012: choices ç¯å¢ƒæ£€æŸ¥
- âœ… T013: é¢˜å¹²å­˜åœ¨æ€§

### å›¾ç‰‡å¤„ç†ï¼ˆT014-T015ï¼‰
- âœ… T014: IMAGE_TODO æ ¼å¼
- âœ… T015: å›¾ç‰‡å±æ€§æ¸…ç†

### ç‰¹æ®Šå¤„ç†ï¼ˆT016-T020ï¼‰
- âš ï¸ T016: LaTeX è½¬ä¹‰ **[P2 é—®é¢˜]**
- âŒ T017: æ•°å­¦æ¨¡å¼å†…ä¸­æ–‡æ ‡ç‚¹ **[P2 é—®é¢˜]**
- âœ… T018: array/cases å·¦æ‹¬å·
- âœ… T019: tabular åˆ—æ ¼å¼
- âœ… T020: explain ç©ºè¡Œ

## æµ‹è¯•ç»“æœæ‘˜è¦

**æœ€æ–°æµ‹è¯•**: 2025-11-28  
**æµ‹è¯•è¯•å·**: 9 ä»½  
**æ•´ä½“é€šè¿‡ç‡**: 85.2% (138/162)

### å…³é”®é—®é¢˜

| é—®é¢˜ | ä¸¥é‡ç¨‹åº¦ | å½±å“èŒƒå›´ | çŠ¶æ€ |
|------|---------|---------|------|
| å®šç•Œç¬¦ä¸å¹³è¡¡ | P0 | 9/9 è¯•å· | âŒ éœ€è¦ä¿®å¤ |
| æ•°å­¦æ¨¡å¼å†…ä¸­æ–‡æ ‡ç‚¹ | P2 | 9/9 è¯•å· | âš ï¸ å»ºè®®ä¼˜åŒ– |
| LaTeX å­—ç¬¦æœªè½¬ä¹‰ | P2 | 6/9 è¯•å· | âš ï¸ å»ºè®®ä¼˜åŒ– |

è¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹ `ISSUES.md`ã€‚

## æµ‹è¯•æŠ¥å‘Šæ ¼å¼

### ç»ˆç«¯è¾“å‡º
```
============================================================
ğŸ“‹ OCR é»‘ç®±æµ‹è¯•æŠ¥å‘Š
   æ–‡ä»¶: word_to_tex/output/exam_preprocessed.md
   æ—¶é—´: 2025-11-28T00:01:13.675204
============================================================

âœ… [T001] ã€ç­”æ¡ˆã€‘æå–
   æ‰¾åˆ° 19 ä¸ª \answerï¼ŒMarkdown ä¸­æœ‰ 19 ä¸ªã€ç­”æ¡ˆã€‘
   â””â”€ æå–ç‡: 100.0%

âŒ [T008] å®šç•Œç¬¦å¹³è¡¡
   \( = 690, \) = 687, diff = 3
   â””â”€ ä¸å¹³è¡¡ï¼Œå·®å€¼ 3

------------------------------------------------------------
ğŸ“Š æ±‡æ€»: é€šè¿‡ 15/18, å¤±è´¥ 3
============================================================
```

### JSON æŠ¥å‘Š
æ¯ä¸ªæµ‹è¯•ç”Ÿæˆ `reports/<exam_name>_test_report.json`ï¼š

```json
{
  "exam_file": "path/to/exam.md",
  "timestamp": "2025-11-28T00:01:13.675204",
  "summary": {
    "total": 18,
    "passed": 15,
    "failed": 3
  },
  "results": [
    {
      "test_id": "T001",
      "name": "ã€ç­”æ¡ˆã€‘æå–",
      "passed": true,
      "message": "æ‰¾åˆ° 19 ä¸ª \\answerï¼ŒMarkdown ä¸­æœ‰ 19 ä¸ªã€ç­”æ¡ˆã€‘",
      "details": "æå–ç‡: 100.0%"
    }
  ]
}
```

## æ·»åŠ æ–°æµ‹è¯•ç”¨ä¾‹

1. **å®šä¹‰æµ‹è¯•ç”¨ä¾‹**: åœ¨ `test_cases.md` ä¸­æ·»åŠ æè¿°
2. **å®ç°æµ‹è¯•æ–¹æ³•**: åœ¨ `run_tests.py` ä¸­æ·»åŠ  `test_TXXX_<name>()` æ–¹æ³•
3. **æ›´æ–°æ–‡æ¡£**: æ›´æ–°æœ¬ README å’Œ `test_cases.md`

ç¤ºä¾‹ï¼š
```python
def test_T021_new_test(self):
    """T021: æ–°æµ‹è¯•çš„æè¿°"""
    # æµ‹è¯•é€»è¾‘
    pattern = r'...'
    matches = re.findall(pattern, self.tex_content)
    
    passed = len(matches) == 0
    self.report.add(TestResult(
        test_id="T021",
        name="æ–°æµ‹è¯•",
        passed=passed,
        message=f"å‘ç° {len(matches)} å¤„é—®é¢˜"
    ))
```

## è¾¹ç•Œæµ‹è¯•

åˆ›å»ºç‰¹æ®Šçš„è¾¹ç•Œç”¨ä¾‹ï¼š

```bash
cat > tools/testing/ocr_blackbox_tests/edge_cases/edge_test_01.md << 'EOF'
# è¾¹ç•Œæµ‹è¯• 1ï¼šåµŒå¥—æ•°å­¦å…¬å¼

1. å·²çŸ¥ $a = \(b + c\)$ æ±‚è§£ã€‚

ã€ç­”æ¡ˆã€‘A
ã€éš¾åº¦ã€‘0.5
ã€è¯¦è§£ã€‘è¿™æ˜¯è¯¦è§£ã€‚
EOF

python3 tools/testing/ocr_blackbox_tests/run_tests.py \
    tools/testing/ocr_blackbox_tests/edge_cases/edge_test_01.md
```

## é—®é¢˜ä¸¥é‡ç¨‹åº¦åˆ†çº§

- **P0**: å¯¼è‡´ç¼–è¯‘å¤±è´¥ï¼ˆå®šç•Œç¬¦ä¸å¹³è¡¡ã€ç¯å¢ƒä¸é—­åˆï¼‰
- **P1**: å¯¼è‡´å†…å®¹é”™è¯¯ï¼ˆã€ç­”æ¡ˆã€‘ä¸¢å¤±ã€ã€åˆ†æã€‘æœªè¿‡æ»¤ï¼‰
- **P2**: å¯¼è‡´æ ¼å¼é—®é¢˜ï¼ˆç©ºè¡Œã€å›¾ç‰‡å±æ€§æ®‹ç•™ã€ä¸­æ–‡æ ‡ç‚¹ï¼‰

## CI/CD é›†æˆ

å¯ä»¥å°†æµ‹è¯•é›†æˆåˆ°æŒç»­é›†æˆæµç¨‹ï¼š

```bash
#!/bin/bash
# test.sh

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
for f in word_to_tex/output/*_preprocessed.md; do
    python3 tools/testing/ocr_blackbox_tests/run_tests.py "$f" || exit 1
done

# ç”ŸæˆæŠ¥å‘Š
python3 tools/testing/ocr_blackbox_tests/analyze_results.py

echo "âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡"
```

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•åªè¿è¡Œç‰¹å®šçš„æµ‹è¯•ç”¨ä¾‹ï¼Ÿ
A: ä¿®æ”¹ `run_tests.py` ä¸­çš„ `run_all_tests()` æ–¹æ³•ï¼Œæ³¨é‡Šæ‰ä¸éœ€è¦çš„æµ‹è¯•ã€‚

### Q: æµ‹è¯•å¤±è´¥æ—¶å¦‚ä½•è°ƒè¯•ï¼Ÿ
A: æŸ¥çœ‹ `output/` ç›®å½•ä¸‹ç”Ÿæˆçš„ TeX æ–‡ä»¶ï¼Œå¯¹æ¯”åŸå§‹ Markdown æ–‡ä»¶ã€‚

### Q: å¦‚ä½•æ›´æ–°æµ‹è¯•æ•°æ®ï¼Ÿ
A: å°†æ–°çš„ `*_preprocessed.md` æ–‡ä»¶æ”¾å…¥ `word_to_tex/output/` ç›®å½•ï¼Œé‡æ–°è¿è¡Œæµ‹è¯•ã€‚

## ç›¸å…³å·¥å…·

- `tools/validate_tex.py`: éªŒè¯ç”Ÿæˆçš„ TeX æ–‡ä»¶è¯­æ³•
- `tools/testing/math_sm_comparison.py`: å¯¹æ¯”æ•°å­¦å…¬å¼çŠ¶æ€æœºå‰åæ•ˆæœ

## è´¡çŒ®æŒ‡å—

å‘ç°æ–°é—®é¢˜æ—¶ï¼š
1. åœ¨ `ISSUES.md` ä¸­è®°å½•é—®é¢˜
2. æ·»åŠ å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹
3. æä¾›æœ€å°å¯å¤ç°ç¤ºä¾‹

## è®¸å¯è¯

ä¸ä¸»é¡¹ç›®ç›¸åŒã€‚
