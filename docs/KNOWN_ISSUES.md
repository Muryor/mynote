# å¸¸è§ OCR é”™è¯¯åŠä¿®å¤æ–¹æ³•

> **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0ï¼ˆ2025-11-20ï¼‰  
> **ç»´æŠ¤è¯´æ˜**ï¼šè®°å½• Word â†’ Markdown â†’ LaTeX æµæ°´çº¿ä¸­å¸¸è§çš„ OCR è½¬æ¢é”™è¯¯åŠä¿®å¤æ–¹æ³•

---

## ğŸ“‹ ç›®å½•

1. [Meta åŒºåŸŸé—®é¢˜](#1-meta-åŒºåŸŸé—®é¢˜)
2. [æ•°å­¦å…¬å¼é”™è¯¯](#2-æ•°å­¦å…¬å¼é”™è¯¯)
3. [æ‹¬å·ä¸å®šç•Œç¬¦é—®é¢˜](#3-æ‹¬å·ä¸å®šç•Œç¬¦é—®é¢˜)
4. [ç¯å¢ƒä¸ç»“æ„é”™è¯¯](#4-ç¯å¢ƒä¸ç»“æ„é”™è¯¯)
5. [å›¾ç‰‡ç›¸å…³é—®é¢˜](#5-å›¾ç‰‡ç›¸å…³é—®é¢˜)
6. [æ–‡æœ¬æ ¼å¼é—®é¢˜](#6-æ–‡æœ¬æ ¼å¼é—®é¢˜)
7. [ç¼–è¯‘é”™è¯¯æ¨¡å¼](#7-ç¼–è¯‘é”™è¯¯æ¨¡å¼)

---

## 1. Meta åŒºåŸŸé—®é¢˜

### 1.1 ã€åˆ†æã€‘å†…å®¹æœªåˆ é™¤

**é”™è¯¯ç°è±¡**ï¼š
```latex
\explain{
  ã€è¯¦è§£ã€‘è¿™æ˜¯æ­£ç¡®çš„è§£æå†…å®¹
  ã€åˆ†æã€‘è¿™æ˜¯åº”è¯¥åˆ é™¤çš„å†…å®¹
}
```

**æ ¹æœ¬åŸå› **ï¼š
- OCR å°†è¯•å·ä¸­çš„"åˆ†æ"éƒ¨åˆ†è¯†åˆ«ä¸ºå…ƒæ•°æ®
- `ocr_to_examx.py` åªåº”ä¿ç•™ã€è¯¦è§£ã€‘å†…å®¹

**æ£€æµ‹æ–¹æ³•**ï¼š
```bash
grep -n "ã€åˆ†æã€‘" content/exams/auto/*/converted_exam.tex
```

**ä¿®å¤æ–¹æ³•**ï¼š
```bash
# æ‰‹åŠ¨åˆ é™¤ \explain ä¸­çš„ã€åˆ†æã€‘æ®µè½
# æˆ–å¢å¼º Python è½¬æ¢å™¨çš„è¿‡æ»¤é€»è¾‘
```

**é¢„é˜²æªæ–½**ï¼š
- åœ¨ `ocr_to_examx.py` çš„ `detect_question_issues()` ä¸­å¢åŠ ã€åˆ†æã€‘æ£€æµ‹
- è½¬æ¢æ—¶æŠ¥å‘ŠåŒ…å«ã€åˆ†æã€‘çš„é¢˜ç›®åˆ° `debug/<slug>_issues.log`

---

### 1.2 ã€è¯¦è§£ã€‘æ ‡è®°æ®‹ç•™

**é”™è¯¯ç°è±¡**ï¼š
```latex
\explain{
  ã€è¯¦è§£ã€‘è§£ï¼šå› ä¸º $f(x) = \sin x$...
}
```

**æ ¹æœ¬åŸå› **ï¼š
- è½¬æ¢æ—¶æœªç§»é™¤ã€è¯¦è§£ã€‘æ ‡è®°æœ¬èº«

**æ£€æµ‹æ–¹æ³•**ï¼š
```bash
grep -n "ã€è¯¦è§£ã€‘" content/exams/auto/*/converted_exam.tex
```

**ä¿®å¤æ–¹æ³•**ï¼š
```latex
\explain{
  è§£ï¼šå› ä¸º $f(x) = \sin x$...
}
```

**é¢„é˜²æªæ–½**ï¼š
- åœ¨ `ocr_to_examx.py` ä¸­æ·»åŠ  `.replace("ã€è¯¦è§£ã€‘", "")` å¤„ç†
- è‡ªåŠ¨åŒ–æ¸…ç†æ‰€æœ‰å…ƒæ ‡è®°

---

### 1.3 ç©º \explain æˆ– \explain ç¼ºå¤±

**é”™è¯¯ç°è±¡**ï¼š
```latex
\begin{question}[é¢˜ç›®å†…å®¹]
  ...
\end{question}
% ç¼ºå°‘ \explain{...}
```

**æ ¹æœ¬åŸå› **ï¼š
- OCR æœªè¯†åˆ«åˆ°ã€è¯¦è§£ã€‘éƒ¨åˆ†
- æˆ– Markdown ä¸­ç­”æ¡ˆç¼ºå¤±

**æ£€æµ‹æ–¹æ³•**ï¼š
```bash
python3 tools/validate_tex.py content/exams/auto/*/converted_exam.tex
# æŸ¥æ‰¾ "Question missing \explain" è­¦å‘Š
```

**ä¿®å¤æ–¹æ³•**ï¼š
```latex
\begin{question}[é¢˜ç›®å†…å®¹]
  ...
\end{question}
\explain{
  % TODO: è¡¥å……è§£æå†…å®¹
}
```

**é¢„é˜²æªæ–½**ï¼š
- `ocr_to_examx.py` çš„ `detect_question_issues()` å·²æ£€æµ‹æ­¤é—®é¢˜
- æŸ¥çœ‹ `debug/<slug>_issues.log` ä¸­çš„æŠ¥å‘Š

---

## 2. æ•°å­¦å…¬å¼é”™è¯¯

### 2.1 è¡Œå†…å…¬å¼ä¸è¡Œé—´å…¬å¼æ··æ·†

**é”™è¯¯ç°è±¡**ï¼š
```latex
% é”™è¯¯ï¼šé¢˜å¹²ä¸­ä½¿ç”¨è¡Œé—´å…¬å¼
\begin{question}[å·²çŸ¥å‡½æ•° $$f(x) = \sin x$$]
  ...
\end{question}
```

**æ ¹æœ¬åŸå› **ï¼š
- OCR å°†æ‰€æœ‰å…¬å¼è¯†åˆ«ä¸º `$$...$$` è¡Œé—´æ ¼å¼
- é¢˜å¹²ã€é€‰é¡¹åº”ä½¿ç”¨ `$...$` è¡Œå†…æ ¼å¼

**æ£€æµ‹æ–¹æ³•**ï¼š
```bash
grep -n '\$\$' content/exams/auto/*/converted_exam.tex | grep -v '\\explain'
```

**ä¿®å¤æ–¹æ³•**ï¼š
```latex
\begin{question}[å·²çŸ¥å‡½æ•° $f(x) = \sin x$]
  ...
\end{question}
```

**é¢„é˜²æªæ–½**ï¼š
- ä½¿ç”¨ `tools/utils/convert_display_to_inline.py` è‡ªåŠ¨è½¬æ¢
- åœ¨ `ocr_to_examx.py` ä¸­å¢åŠ æ™ºèƒ½åˆ¤æ–­ï¼šé¢˜å¹²/é€‰é¡¹â†’è¡Œå†…ï¼Œ\explainâ†’ä¿ç•™è¡Œé—´

---

### 2.2 æ•°å­¦å®šç•Œç¬¦ä¸åŒ¹é…

**é”™è¯¯ç°è±¡**ï¼š
```latex
\explain{
  è§£ï¼š$f(x) = \sin x
}
```

**æ ¹æœ¬åŸå› **ï¼š
- OCR ä¸¢å¤±ç»“æŸå®šç•Œç¬¦ `$`
- æˆ–è¯¯å°† `$$` æ‹†åˆ†æˆä¸¤ä¸ª `$`

**æ£€æµ‹æ–¹æ³•**ï¼š
```bash
python3 tools/validate_tex.py content/exams/auto/*/converted_exam.tex
# æŸ¥æ‰¾ "Unbalanced math delimiter" é”™è¯¯
```

**ä¿®å¤æ–¹æ³•**ï¼š
```latex
\explain{
  è§£ï¼š$f(x) = \sin x$
}
```

**é¢„é˜²æªæ–½**ï¼š
- `validate_tex.py` åœ¨ç¼–è¯‘å‰è‡ªåŠ¨æ£€æµ‹
- ä½¿ç”¨ç¼–è¾‘å™¨çš„æ‹¬å·é«˜äº®åŠŸèƒ½

---

### 2.3 ç‰¹æ®Šç¬¦å· OCR é”™è¯¯

**é”™è¯¯ç°è±¡**ï¼š
```latex
% OCR è¯¯è¯†åˆ«
$\alpha$ â†’ $a$
$\beta$ â†’ $B$
$\geq$ â†’ $>=$
$\in$ â†’ $E$
```

**æ ¹æœ¬åŸå› **ï¼š
- OCR å¼•æ“å¯¹æ•°å­¦ç¬¦å·è¯†åˆ«ä¸å‡†ç¡®
- Pandoc è½¬æ¢æ—¶æ— æ³•æ¢å¤

**æ£€æµ‹æ–¹æ³•**ï¼š
- äººå·¥å¯¹ç…§åŸå§‹ PDF æ£€æŸ¥
- æˆ–ä½¿ç”¨ä¸“ä¸šæ•°å­¦ OCR å·¥å…·ï¼ˆMathpixï¼‰

**ä¿®å¤æ–¹æ³•**ï¼š
- æ‰‹åŠ¨çº æ­£ç¬¦å·é”™è¯¯
- å»ºç«‹å¸¸è§é”™è¯¯æ›¿æ¢è¡¨

**é¢„é˜²æªæ–½**ï¼š
- ä½¿ç”¨ Mathpix æˆ–å…¶ä»–ä¸“ä¸šæ•°å­¦ OCR å·¥å…·
- åœ¨ Markdown é˜¶æ®µè¿›è¡Œäººå·¥æ ¡å¯¹

---

## 3. æ‹¬å·ä¸å®šç•Œç¬¦é—®é¢˜

### 3.1 å¤§æ‹¬å·ä¸å¹³è¡¡

**é”™è¯¯ç°è±¡**ï¼š
```latex
\explain{
  è§£ï¼šå› ä¸º $\{x \mid x > 0$...
}
% ç¼ºå°‘ç»“æŸèŠ±æ‹¬å·
```

**æ ¹æœ¬åŸå› **ï¼š
- OCR ä¸¢å¤±é…å¯¹çš„ `}`
- æˆ–åœ¨ Markdown â†’ TeX è½¬æ¢æ—¶è¢«è½¬ä¹‰é”™è¯¯

**æ£€æµ‹æ–¹æ³•**ï¼š
```bash
python3 tools/validate_tex.py content/exams/auto/*/converted_exam.tex
# æŸ¥æ‰¾ "Unbalanced braces" é”™è¯¯
```

**ä¿®å¤æ–¹æ³•**ï¼š
```latex
\explain{
  è§£ï¼šå› ä¸º $\{x \mid x > 0\}$...
}
```

**é¢„é˜²æªæ–½**ï¼š
- `validate_tex.py` è‡ªåŠ¨æ£€æµ‹
- ä½¿ç”¨ç¼–è¾‘å™¨çš„æ‹¬å·åŒ¹é…åŠŸèƒ½

---

### 3.2 æ–¹æ‹¬å·è½¬ä¹‰é—®é¢˜

**é”™è¯¯ç°è±¡**ï¼š
```latex
\begin{question}[åŒºé—´ [0, 1] ä¸Šçš„å‡½æ•°]
  ...
\end{question}
% LaTeX é”™è¯¯ï¼šOptional argument not properly closed
```

**æ ¹æœ¬åŸå› **ï¼š
- LaTeX å°† `[...]` è¯†åˆ«ä¸ºå¯é€‰å‚æ•°å®šç•Œç¬¦
- é¢˜å¹²ä¸­çš„æ•°å­¦åŒºé—´ `[0, 1]` æœªè½¬ä¹‰

**æ£€æµ‹æ–¹æ³•**ï¼š
- ç¼–è¯‘æ—¶æŠ¥é”™ï¼š`Runaway argument`

**ä¿®å¤æ–¹æ³•**ï¼š
```latex
\begin{question}[åŒºé—´ {[}0, 1{]} ä¸Šçš„å‡½æ•°]
  % æˆ–ä½¿ç”¨
\begin{question}[åŒºé—´ $[0, 1]$ ä¸Šçš„å‡½æ•°]
  ...
\end{question}
```

**é¢„é˜²æªæ–½**ï¼š
- åœ¨ `ocr_to_examx.py` ä¸­è‡ªåŠ¨è½¬ä¹‰ `[` â†’ `{[}`ï¼Œ`]` â†’ `{]}`
- æˆ–ç»Ÿä¸€ä½¿ç”¨æ•°å­¦æ¨¡å¼ `$[0, 1]$`

---

## 4. ç¯å¢ƒä¸ç»“æ„é”™è¯¯

### 4.1 question ç¯å¢ƒæœªé—­åˆ

**é”™è¯¯ç°è±¡**ï¼š
```latex
\begin{question}[é¢˜ç›®å†…å®¹]
  é€‰é¡¹å†…å®¹
% ç¼ºå°‘ \end{question}

\explain{...}
```

**æ ¹æœ¬åŸå› **ï¼š
- è½¬æ¢è„šæœ¬é€»è¾‘é”™è¯¯
- æˆ–é¢˜ç›®è¾¹ç•Œè¯†åˆ«å¤±è´¥

**æ£€æµ‹æ–¹æ³•**ï¼š
```bash
python3 tools/validate_tex.py content/exams/auto/*/converted_exam.tex
# æŸ¥æ‰¾ "Unclosed environment" é”™è¯¯
```

**ä¿®å¤æ–¹æ³•**ï¼š
```latex
\begin{question}[é¢˜ç›®å†…å®¹]
  é€‰é¡¹å†…å®¹
\end{question}
\explain{...}
```

**é¢„é˜²æªæ–½**ï¼š
- `ocr_to_examx.py` çš„ç¯å¢ƒåŒ¹é…é€»è¾‘ä¸¥æ ¼æ£€æŸ¥
- `validate_tex.py` åœ¨ç¼–è¯‘å‰éªŒè¯

---

### 4.2 \explain ä¸­åŒ…å«æ®µè½åˆ†éš”

**é”™è¯¯ç°è±¡**ï¼š
```latex
\explain{
  è§£ï¼šç¬¬ä¸€æ­¥...

  ç¬¬äºŒæ­¥...
}
% ç¼–è¯‘é”™è¯¯ï¼šRunaway argument
```

**æ ¹æœ¬åŸå› **ï¼š
- `\explain` æ˜¯å‘½ä»¤è€Œéç¯å¢ƒï¼Œä¸å…è®¸æ®µè½åˆ†éš”ï¼ˆç©ºè¡Œï¼‰

**æ£€æµ‹æ–¹æ³•**ï¼š
```bash
python3 tools/validate_tex.py content/exams/auto/*/converted_exam.tex
# æŸ¥æ‰¾ "Paragraph break inside \\explain" é”™è¯¯
```

**ä¿®å¤æ–¹æ³•**ï¼š
```latex
\explain{
  è§£ï¼šç¬¬ä¸€æ­¥... \par
  ç¬¬äºŒæ­¥...
}
% æˆ–ä½¿ç”¨ \\ æ¢è¡Œ
\explain{
  è§£ï¼šç¬¬ä¸€æ­¥... \\
  ç¬¬äºŒæ­¥...
}
```

**é¢„é˜²æªæ–½**ï¼š
- `validate_tex.py` è‡ªåŠ¨æ£€æµ‹ç©ºè¡Œ
- è½¬æ¢æ—¶è‡ªåŠ¨æ›¿æ¢ `\n\n` â†’ `\par`

---

### 4.3 åµŒå¥—ç¯å¢ƒé”™è¯¯

**é”™è¯¯ç°è±¡**ï¼š
```latex
\begin{question}[...]
  \begin{enumerate}
    \item é€‰é¡¹ A
  \begin{question}[...]  % é”™è¯¯åµŒå¥—
```

**æ ¹æœ¬åŸå› **ï¼š
- é¢˜ç›®è¾¹ç•Œè¯†åˆ«é”™è¯¯
- æˆ– Markdown ç»“æ„å±‚æ¬¡æ··ä¹±

**æ£€æµ‹æ–¹æ³•**ï¼š
- ç¼–è¯‘æ—¶æŠ¥é”™ï¼š`LaTeX Error: \begin{question} on input line ... ended by \end{enumerate}`

**ä¿®å¤æ–¹æ³•**ï¼š
- æ‰‹åŠ¨è°ƒæ•´é¢˜ç›®è¾¹ç•Œ
- ç¡®ä¿æ¯ä¸ª `\begin{question}` éƒ½æœ‰å¯¹åº”çš„ `\end{question}`

---

## 5. å›¾ç‰‡ç›¸å…³é—®é¢˜

### 5.1 IMAGE_TODO å—ç¼ºå¤±

**é”™è¯¯ç°è±¡**ï¼š
```latex
% é¢˜ç›®ä¸­æœ‰"å¦‚å›¾æ‰€ç¤º"ï¼Œä½†æ— å¯¹åº” IMAGE_TODO
\begin{question}[å¦‚å›¾æ‰€ç¤ºï¼Œå‡½æ•° $f(x)$ çš„å›¾è±¡...]
  ...
\end{question}
```

**æ ¹æœ¬åŸå› **ï¼š
- Pandoc ä» Word è½¬ Markdown æ—¶ä¸¢å¤±å›¾ç‰‡å¼•ç”¨
- æˆ– OCR æœªè¯†åˆ«å›¾ç‰‡ä½ç½®

**æ£€æµ‹æ–¹æ³•**ï¼š
```bash
# æŸ¥æ‰¾å«"å¦‚å›¾"ä½†æ—  IMAGE_TODO çš„é¢˜ç›®
grep -n "å¦‚å›¾" content/exams/auto/*/converted_exam.tex | while read line; do
  file=$(echo $line | cut -d: -f1)
  linenum=$(echo $line | cut -d: -f2)
  if ! grep -A 20 "^$(sed -n "${linenum}p" "$file")" "$file" | grep -q "IMAGE_TODO"; then
    echo "ç¼ºå¤±å›¾ç‰‡ï¼š$line"
  fi
done
```

**ä¿®å¤æ–¹æ³•**ï¼š
```latex
\begin{question}[å¦‚å›¾æ‰€ç¤ºï¼Œå‡½æ•° $f(x)$ çš„å›¾è±¡...]
  % IMAGE_TODO_START id=slug-Q3-img1 path=word_to_tex/output/figures/media/image1.png width=60% inline=false question_index=3 sub_index=1
  \begin{center}
    % TODO: AI_AGENT_REPLACE_ME (id=slug-Q3-img1)
  \end{center}
  % IMAGE_TODO_END id=slug-Q3-img1
  ...
\end{question}
```

**é¢„é˜²æªæ–½**ï¼š
- æ£€æŸ¥ `word_to_tex/output/figures/media/` ä¸­çš„å›¾ç‰‡æ•°é‡
- å¯¹ç…§ TeX ä¸­çš„ IMAGE_TODO æ•°é‡
- æ‰‹åŠ¨è¡¥å……ç¼ºå¤±çš„å ä½å—

---

### 5.2 å›¾ç‰‡è·¯å¾„é”™è¯¯

**é”™è¯¯ç°è±¡**ï¼š
```latex
% IMAGE_TODO_START path=output/figures/media/image1.png
% å®é™…æ–‡ä»¶åœ¨ word_to_tex/output/figures/media/image1.png
```

**æ ¹æœ¬åŸå› **ï¼š
- è½¬æ¢è„šæœ¬ä½¿ç”¨ç›¸å¯¹è·¯å¾„
- æˆ–ç›®å½•ç»“æ„å˜åŒ–

**æ£€æµ‹æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨
grep "IMAGE_TODO_START" content/exams/auto/*/converted_exam.tex | \
  grep -oE 'path=[^ ]+' | cut -d= -f2 | while read path; do
    [ ! -f "$path" ] && echo "è·¯å¾„ä¸å­˜åœ¨ï¼š$path"
  done
```

**ä¿®å¤æ–¹æ³•**ï¼š
```latex
% IMAGE_TODO_START path=word_to_tex/output/figures/media/image1.png
```

**é¢„é˜²æªæ–½**ï¼š
- ä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–é¡¹ç›®æ ¹ç›®å½•ç›¸å¯¹è·¯å¾„
- åœ¨ `export_image_jobs.py` ä¸­éªŒè¯è·¯å¾„

---

### 5.3 å›¾ç‰‡å®½åº¦å‚æ•°ä¸åˆç†

**é”™è¯¯ç°è±¡**ï¼š
```latex
% IMAGE_TODO_START width=200%  % å›¾ç‰‡è¿‡å¤§
% IMAGE_TODO_START width=5%    % å›¾ç‰‡è¿‡å°
```

**æ ¹æœ¬åŸå› **ï¼š
- OCR æœªæä¾›å›¾ç‰‡å°ºå¯¸ä¿¡æ¯
- æˆ–é»˜è®¤å€¼è®¾ç½®ä¸å½“

**æ£€æµ‹æ–¹æ³•**ï¼š
```bash
grep "IMAGE_TODO_START" content/exams/auto/*/converted_exam.tex | \
  grep -oE 'width=[0-9]+%' | sort | uniq -c
```

**ä¿®å¤æ–¹æ³•**ï¼š
```latex
% å…¸å‹å»ºè®®ï¼š
% - è¡Œå†…å°å›¾ï¼š30%-50%
% - ç‹¬ç«‹å›¾ç¤ºï¼š60%-80%
% - å¤§å‹å›¾è¡¨ï¼š80%-100%
% IMAGE_TODO_START width=70%
```

---

## 6. æ–‡æœ¬æ ¼å¼é—®é¢˜

### 6.1 ä¸­æ–‡æ ‡ç‚¹è¯†åˆ«é”™è¯¯

**é”™è¯¯ç°è±¡**ï¼š
```latex
% OCR è¯¯è¯†åˆ«
ï¼Œâ†’ ,
ã€‚â†’ .
ï¼ˆ ï¼‰â†’ ( )
```

**æ ¹æœ¬åŸå› **ï¼š
- OCR å¼•æ“æ··æ·†ä¸­è‹±æ–‡æ ‡ç‚¹
- æˆ– Word æ–‡æ¡£ä¸­æ··ç”¨æ ‡ç‚¹

**æ£€æµ‹æ–¹æ³•**ï¼š
```bash
# æŸ¥æ‰¾è‹±æ–‡æ ‡ç‚¹åç´§è·Ÿä¸­æ–‡çš„æƒ…å†µ
grep -nE '[,\.][\u4e00-\u9fa5]' content/exams/auto/*/converted_exam.tex
```

**ä¿®å¤æ–¹æ³•**ï¼š
- æ‰‹åŠ¨æ›¿æ¢ä¸ºä¸­æ–‡æ ‡ç‚¹
- ä½¿ç”¨æ­£åˆ™æ‰¹é‡æ›¿æ¢

**é¢„é˜²æªæ–½**ï¼š
- åœ¨ Markdown é˜¶æ®µè¿›è¡Œäººå·¥æ ¡å¯¹
- æˆ–å¢åŠ åå¤„ç†è„šæœ¬

---

### 6.2 æ¢è¡Œç¬¦å¤„ç†é”™è¯¯

**é”™è¯¯ç°è±¡**ï¼š
```latex
\explain{è§£ï¼šå› ä¸º $f(x)$
æ»¡è¶³æ¡ä»¶}
% åº”ä¿æŒåœ¨åŒä¸€æ®µè½
```

**æ ¹æœ¬åŸå› **ï¼š
- Markdown ä¿ç•™äº†åŸå§‹æ¢è¡Œ
- TeX ä¸­æ¢è¡Œå¯¼è‡´ç©ºæ ¼

**æ£€æµ‹æ–¹æ³•**ï¼š
- äººå·¥æ£€æŸ¥ \explain å†…å®¹æ ¼å¼

**ä¿®å¤æ–¹æ³•**ï¼š
```latex
\explain{è§£ï¼šå› ä¸º $f(x)$ æ»¡è¶³æ¡ä»¶}
```

---

### 6.3 ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ç¼ºå¤±

**é”™è¯¯ç°è±¡**ï¼š
```latex
\begin{question}[å æ¯” 50%]  % LaTeX é”™è¯¯
\begin{question}[ä»·æ ¼ $100]  % LaTeX é”™è¯¯
```

**æ ¹æœ¬åŸå› **ï¼š
- LaTeX ä¿ç•™å­—ç¬¦ `% $ & # _ { } ~ ^` æœªè½¬ä¹‰

**æ£€æµ‹æ–¹æ³•**ï¼š
- ç¼–è¯‘æ—¶æŠ¥é”™

**ä¿®å¤æ–¹æ³•**ï¼š
```latex
\begin{question}[å æ¯” 50\%]
\begin{question}[ä»·æ ¼ \$100]
```

**é¢„é˜²æªæ–½**ï¼š
- åœ¨ `ocr_to_examx.py` ä¸­è‡ªåŠ¨è½¬ä¹‰
- æˆ–ä½¿ç”¨æ•°å­¦æ¨¡å¼åŒ…è£¹

---

## 7. ç¼–è¯‘é”™è¯¯æ¨¡å¼

### 7.1 Runaway argument

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Runaway argument?
! Paragraph ended before \explain was complete.
```

**å¸¸è§åŸå› **ï¼š
1. `\explain{...}` ä¸­åŒ…å«ç©ºè¡Œ
2. æ‹¬å·ä¸åŒ¹é…ï¼ˆç¼ºå°‘ `}`ï¼‰
3. `[...]` å¯é€‰å‚æ•°æœªé—­åˆ

**å®šä½æ–¹æ³•**ï¼š
```bash
tools/locate_error.sh output/.aux/wrap-exam-teacher.log
```

**ä¿®å¤æµç¨‹**ï¼š
1. ä½¿ç”¨ `locate_error.sh` å®šä½é”™è¯¯è¡Œ
2. æ£€æŸ¥å¯¹åº”å‘½ä»¤çš„å‚æ•°æ˜¯å¦å®Œæ•´
3. ç§»é™¤ç©ºè¡Œæˆ–æ·»åŠ ç¼ºå¤±çš„å®šç•Œç¬¦

---

### 7.2 Missing $ inserted

**é”™è¯¯ä¿¡æ¯**ï¼š
```
! Missing $ inserted.
<inserted text> 
                $
l.123 è§£ï¼šå› ä¸º f(x) = \sin x
```

**å¸¸è§åŸå› **ï¼š
1. æ•°å­¦ç¬¦å·æœªåŒ…è£¹åœ¨ `$...$` ä¸­
2. æ•°å­¦å®šç•Œç¬¦ä¸åŒ¹é…

**å®šä½æ–¹æ³•**ï¼š
```bash
tools/locate_error.sh output/.aux/wrap-exam-teacher.log
```

**ä¿®å¤æ–¹æ³•**ï¼š
```latex
è§£ï¼šå› ä¸º $f(x) = \sin x$
```

---

### 7.3 Undefined control sequence

**é”™è¯¯ä¿¡æ¯**ï¼š
```
! Undefined control sequence.
l.456 \unknowncommand
```

**å¸¸è§åŸå› **ï¼š
1. ä½¿ç”¨äº†æœªå®šä¹‰çš„å‘½ä»¤
2. å®åŒ…æœªåŠ è½½
3. æ‹¼å†™é”™è¯¯

**å®šä½æ–¹æ³•**ï¼š
```bash
tools/locate_error.sh output/.aux/wrap-exam-teacher.log
grep -n "unknowncommand" content/exams/auto/*/converted_exam.tex
```

**ä¿®å¤æ–¹æ³•**ï¼š
- æ£€æŸ¥å‘½ä»¤æ‹¼å†™
- ç¡®è®¤æ‰€éœ€å®åŒ…å·²åŠ è½½
- æˆ–ç§»é™¤æœªå®šä¹‰çš„å‘½ä»¤

---

### 7.4 Environment ... undefined

**é”™è¯¯ä¿¡æ¯**ï¼š
```
! LaTeX Error: Environment choices undefined.
```

**å¸¸è§åŸå› **ï¼š
1. ç¯å¢ƒåæ‹¼å†™é”™è¯¯ï¼ˆå¦‚ `choices` â†’ `choice`ï¼‰
2. ç¯å¢ƒæœªåœ¨æ ·å¼æ–‡ä»¶ä¸­å®šä¹‰

**å®šä½æ–¹æ³•**ï¼š
```bash
grep -n "\\begin{choices}" content/exams/auto/*/converted_exam.tex
```

**ä¿®å¤æ–¹æ³•**ï¼š
```latex
% examx.sty ä¸­å®šä¹‰çš„ç¯å¢ƒæ˜¯ choiceï¼Œä¸æ˜¯ choices
\begin{choice}
  \item A
  \item B
\end{choice}
```

---

## ğŸ“Š ç»Ÿè®¡ä¸ä¼˜å…ˆçº§

### é«˜é¢‘é—®é¢˜ï¼ˆæŒ‰å‡ºç°é¢‘ç‡æ’åºï¼‰

1. **ã€åˆ†æã€‘å†…å®¹æœªåˆ é™¤** - å‡ ä¹æ¯ä¸ªè¯•å·éƒ½å­˜åœ¨
2. **\explain ä¸­åŒ…å«æ®µè½åˆ†éš”** - çº¦ 50% çš„è¯•å·
3. **IMAGE_TODO å—ç¼ºå¤±** - çº¦ 30% çš„è¯•å·
4. **æ•°å­¦å®šç•Œç¬¦ä¸åŒ¹é…** - çº¦ 20% çš„è¯•å·
5. **æ–¹æ‹¬å·è½¬ä¹‰é—®é¢˜** - çº¦ 15% çš„è¯•å·

### ä¿®å¤æˆæœ¬åˆ†çº§

| é—®é¢˜ç±»å‹ | è‡ªåŠ¨åŒ–ä¿®å¤ | æ‰‹åŠ¨æˆæœ¬ | ä¼˜å…ˆçº§ |
|---------|-----------|---------|--------|
| ã€åˆ†æã€‘æœªåˆ é™¤ | âœ… å¯è‡ªåŠ¨åŒ– | ä½ | ğŸ”´ é«˜ |
| \explain æ®µè½åˆ†éš” | âœ… å¯è‡ªåŠ¨åŒ– | ä½ | ğŸ”´ é«˜ |
| IMAGE_TODO ç¼ºå¤± | âš ï¸ åŠè‡ªåŠ¨ | ä¸­ | ğŸŸ¡ ä¸­ |
| æ•°å­¦å®šç•Œç¬¦ä¸åŒ¹é… | âœ… å¯æ£€æµ‹ | ä¸­ | ğŸŸ¡ ä¸­ |
| ç‰¹æ®Šç¬¦å· OCR é”™è¯¯ | âŒ éœ€äººå·¥ | é«˜ | ğŸŸ¢ ä½ |

---

## ğŸ› ï¸ å·¥å…·é“¾ä½¿ç”¨å»ºè®®

### é”™è¯¯æ£€æµ‹ä¼˜å…ˆçº§

1. **è½¬æ¢æ—¶è‡ªåŠ¨æ£€æŸ¥**ï¼ˆocr_to_examx.pyï¼‰
   - ã€åˆ†æã€‘å†…å®¹æ£€æµ‹
   - \explain ç¼ºå¤±æ£€æµ‹
   - ç¯å¢ƒåŒ¹é…æ£€æŸ¥

2. **ç¼–è¯‘å‰è¯­æ³•æ£€æŸ¥**ï¼ˆvalidate_tex.pyï¼‰
   - æ®µè½åˆ†éš”æ£€æµ‹
   - æ‹¬å·å¹³è¡¡æ£€æŸ¥
   - æ•°å­¦å®šç•Œç¬¦æ£€æŸ¥

3. **ç¼–è¯‘åé”™è¯¯å®šä½**ï¼ˆlocate_error.shï¼‰
   - Runaway argument å®šä½
   - Missing $ å®šä½
   - ç¯å¢ƒé”™è¯¯å®šä½

4. **å›å½’æµ‹è¯•**ï¼ˆtest_compile.shï¼‰
   - å››ç»„åˆç¼–è¯‘æµ‹è¯•
   - ç¡®ä¿ä¿®å¤ä¸å¼•å…¥æ–°é—®é¢˜

### å·¥ä½œæµé›†æˆ

```bash
# å®Œæ•´é”™è¯¯æ£€æµ‹æµç¨‹
cd /Users/muryor/code/mynote

# 1. è½¬æ¢æ—¶è‡ªåŠ¨æ£€æŸ¥
python3 tools/core/ocr_to_examx.py \
  word_to_tex/output/<slug>_preprocessed.md \
  <slug> \
  content/exams/auto/<slug>

# 2. æŸ¥çœ‹è‡ªåŠ¨ç”Ÿæˆçš„é—®é¢˜æŠ¥å‘Š
cat word_to_tex/output/debug/<slug>_issues.log

# 3. ç¼–è¯‘å‰è¯­æ³•æ£€æŸ¥
python3 tools/validate_tex.py content/exams/auto/<slug>/converted_exam.tex

# 4. å°è¯•ç¼–è¯‘
./build.sh exam teacher

# 5. å¦‚æœå¤±è´¥ï¼Œå¿«é€Ÿå®šä½é”™è¯¯
tools/locate_error.sh output/.aux/wrap-exam-teacher.log

# 6. ä¿®å¤åå›å½’æµ‹è¯•
tools/test_compile.sh
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- **å·¥ä½œæµæ–‡æ¡£**ï¼š`docs/WORKFLOW_TESTING_PROMPT.md`
- **è½¬æ¢å·¥å…·**ï¼š`tools/core/ocr_to_examx.py`
- **éªŒè¯å·¥å…·**ï¼š`tools/validate_tex.py`
- **é”™è¯¯å®šä½**ï¼š`tools/locate_error.sh`
- **å›å½’æµ‹è¯•**ï¼š`tools/test_compile.sh`

---

## ğŸ”„ æ–‡æ¡£ç»´æŠ¤

**æ›´æ–°é¢‘ç‡**ï¼šå‘ç°æ–°é—®é¢˜æ—¶å³æ—¶æ›´æ–°  
**ç»´æŠ¤è´Ÿè´£**ï¼šLaTeX æµæ°´çº¿å·¥ç¨‹å¸ˆ  
**å†å²è®°å½•**ï¼š
- v1.0ï¼ˆ2025-11-20ï¼‰ï¼šåˆå§‹ç‰ˆæœ¬ï¼ŒåŸºäº nanjing_2026_sep å’Œ zhejiang_lishui_2026_nov è°ƒè¯•ç»éªŒ
