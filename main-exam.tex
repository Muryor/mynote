% ========================= Exam main ============================
% File: main-exam.tex
% Entry for printable exams (exam-zh)
\PassOptionsToClass{fontset=fandol}{ctexbook}
\documentclass{exam-zh}
\makeatletter
\def\input@path{{./styles/}{./settings/}}
\makeatother
% Page layout
\usepackage{geometry}
\geometry{a4paper, left=2cm, right=2cm, top=2.5cm, bottom=2.5cm}

% ðŸ†• v1.9: å¹³å°å­—ä½“è‡ªåŠ¨æ£€æµ‹
% è‡ªåŠ¨å­—ä½“é€‰æ‹©ï¼šé¿å¼€ ifplatform å¯¹ shell-escape çš„ä¾èµ–ï¼Œä½¿ç”¨å­—ä½“å­˜åœ¨æ£€æµ‹
\ifxetex
  \usepackage{xeCJK}
  % ä¼˜å…ˆé¡ºåºï¼šSongti SC (macOS) -> PingFang SC (macOS å¤‡ç”¨) -> FandolSong (TeX Live)
  \IfFontExistsTF{Songti SC}{\setCJKmainfont{Songti SC}}{%
    \IfFontExistsTF{PingFang SC}{\setCJKmainfont{PingFang SC}}{\setCJKmainfont{FandolSong}}%
  }
\fi

% Common preamble (fonts, math, colors, hyperref, etc.)
\usepackage{preamble}

% Our bridge for teacher block & metadata
% NOTE: teacher/student mode is controlled by build.sh via PassOptionsToPackage
% Default is student mode (answers hidden, no metadata boxes)
\usepackage{examx}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{calc}

\input{metadata.tex}

% ---- exam-zh global setup (safe defaults) ----
% Note: teacher/student answer visibility is controlled by examx.sty
\examsetup{
  % fonts kept default (newcm) to be stable across TeX Live
  choices = { max-columns = 4, column-sep = 1em, label-pos = top-left }
}

\begin{document}
  % Title is now set per-exam using \examxtitle{...} in content files
  % No hardcoded default title

  % Content: dynamically loaded from metadata.tex configuration
  % The actual exam file is specified by \examSourceFile in settings/metadata.tex
  \ifx\examSourceFile\undefined
    \PackageError{examx}{%
      No examSourceFile defined in settings/metadata.tex.%
    }{%
      Please define \protect\examSourceFile in settings/metadata.tex to specify which exam to compile.%
    }
  \else
    \ifx\examSourceFile\@empty
      \PackageWarning{examx}{examSourceFile is empty, no content loaded}
    \else
      % Load the exam content specified in metadata
      \input{\examSourceFile}
    \fi
  \fi
\end{document}
